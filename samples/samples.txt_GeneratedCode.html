<!DOCTYPE html>
<html cp-app="global">
  <body>
  <ul>
    <li id="my_li">
        my  Tes t : {{Test}}
        <div id ="z" cp-switch="x">
            <div id ="z1"  cp-switch-case="1"> 1</div>
            <div id ="z2" cp-switch-case="2"> 2</div>
            <div id ="z3" cp-switchDefault> 3</div>
        </div>
      </li>
  </ul>
  </body>
</html>
<script type="text/javascript">
  let renders = [];
  let new_elements = [];
  let changes = [];

  //cp switch
  const switchFunc_z = function () {
    const switchElement = document.getElementById("z");
    const value = global.x;

    let matchFound = false;
    for (let i = 0; i < switchElement.children.length - 1; i++) {
      const child = switchElement.children[i];
      const switchCaseValue = child.getAttribute("cp-switch-case");

      //Switch Case
      if (switchCaseValue !== null) {
         //match case
         if (!matchFound && switchCaseValue == value) {
           child.hidden = false;
           matchFound = true;
         } else {
           child.hidden = true;
         }
      }
    }
    const lastChildren =
      switchElement.children[switchElement.children.length - 1];
    if (!matchFound && lastChildren.getAttribute("cp-switchDefault") !== null) {
      lastChildren.hidden = false;
    } else {
      lastChildren.hidden = true;
    }
  };
  renders.push(switchFunc_z);

   //Curly Braces Renderer
    const curly_render_function_my_li_Test = function() {
    const defaultText = "my  Tes t : {{Test}}";
    if(global.Test !== undefined) {
      document.getElementById("my_li").innerHTML = defaultText.replace(
        `{{Test}}`,
        global.Test
      )
    }
  }
  renders.push(curly_render_function_my_li_Test);

  function render() {
    setInterval(() => {
    for(let i = 0; i < new_elements.length; i++) {
          new_elements[i].remove();
      }
      for(let i = 0; i < changes.length; i++) {
          changes[i]();
      }
      changes = [];
      for (let i = 0; i < renders.length; i++) {
         renders[i]();
      }
    }, 1000);
  }
  render();

</script>