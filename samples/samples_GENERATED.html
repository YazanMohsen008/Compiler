<!DOCTYPE html>
<html lang="en">

<head>
    <title>Sample 7 everything</title>
</head>

<body id="appA" cp-app="forthyear">

    <div>
        <span>Id</span> <input id="modelA" type="number" cp-model="newObj.newId" /> <br />
        <span>Name</span> <input id="modelB" type="text" cp-model="newObj.newName" /> <br />
        <span>Date</span> <input id="modelC" type="date" cp-model="newObj.newDate" /> <br />
        <button id="click" @click="addSt()">Add</button>
    </div>

    <div id="ifA" cp-if="newAddedSt.Id">
        <span>the new St id: {{newAddedSt.newId}}</span>
        <span>the new St Name: {{newAddedSt.newId | lower}}</span>
        <span>the new St Date: {{newAddedSt.newId | date:'dd/mm/yyyy'}}</span> <!-- any date format you want  -->
    </div>

    <table>
        <thead>
            <th id="forA" cp-for="k,v in obj[0]">{{k}}</th>
        </thead>
        <tr id="forB" cp-for="st in obj">
            <td id="forC" cp-for="s in st">{{s}}</td>
        </tr>
    </table>


    <script>
        function forthyear() {
            let scope = this;
            scope.newObj = {};
            scope.newAddedSt = {};
            scope.obj = [
                { id: 1, name: "St1", birthdate: new Date() },
                { id: 2, name: "St2", birthdate: new Date() },
                { id: 3, name: "St3", birthdate: new Date() },
                { id: 4, name: "St4", birthdate: new Date() },
                { id: 5, name: "St5", birthdate: new Date() },
                { id: 6, name: "St6", birthdate: new Date() },
            ]
            scope.addSt = function () {
                scope.newAddedSt = Object.assign({}, scope.newObj)
                scope.obj.push(Object.assign({}, scope.newObj));
                scope.newObj = {};
            }
        };

        var forthyear = new forthyear();

    </script>

</body>
<script type="text/javascript">
  let renders = [];
  let new_elements = [];
  let changes = [];

    //cp model template 
    if (forthyear.newObj.newId) {
      document.getElementById("modelA").value =
        forthyear.newObj.newId;
    }
    document.getElementById("modelA").addEventListener("input", (event) => {
      forthyear.newObj.newId = event.target.value;
    });

    //cp model template 
    if (forthyear.newObj.newName) {
      document.getElementById("modelB").value =
        forthyear.newObj.newName;
    }
    document.getElementById("modelB").addEventListener("input", (event) => {
      forthyear.newObj.newName = event.target.value;
    });

    //cp model template 
    if (forthyear.newObj.newDate) {
      document.getElementById("modelC").value =
        forthyear.newObj.newDate;
    }
    document.getElementById("modelC").addEventListener("input", (event) => {
      forthyear.newObj.newDate = event.target.value;
    });

	 // cp-event 
      const event_handler_click_click = function() {
        document.getElementById("click").addEventListener("click", (event) => {
            forthyear.addSt();
        });
    }
    changes.push(event_handler_click_click);

   //Curly Braces Renderer
    const curly_render_function_Generated ID = function() {
       let defaultText = `the new St id: {{newAddedSt.newId}}`;
       const targetCurlys = [
		'{{newAddedSt.newId}}',
	];

       const filters = [
	   () => {
		let value = forthyear.newAddedSt.newId
		return value;
    	},
	];

       filters.map((filter, index) => {
          defaultText = defaultText.replace(targetCurlys[index], filter());
          document.getElementById("Generated ID").innerHTML = defaultText;
       });
  }
  renders.push(curly_render_function_Generated ID);

   //Curly Braces Renderer
    const curly_render_function_Generated ID = function() {
       let defaultText = `the new St Name: {{newAddedSt.newId|lower}}`;
       const targetCurlys = [
		'{{newAddedSt.newId|lower}}',
	];

       const filters = [
	   () => {
		let value = forthyear.newAddedSt.newId
		value = lower(value);
		return value;
    	},
	];

       filters.map((filter, index) => {
          defaultText = defaultText.replace(targetCurlys[index], filter());
          document.getElementById("Generated ID").innerHTML = defaultText;
       });
  }
  renders.push(curly_render_function_Generated ID);

   //Curly Braces Renderer
    const curly_render_function_Generated ID = function() {
       let defaultText = `the new St Date: {{newAddedSt.newId|date:"dd/mm/yyyy"}}`;
       const targetCurlys = [
		'{{newAddedSt.newId|date:"dd/mm/yyyy"}}',
	];

       const filters = [
	   () => {
		let value = forthyear.newAddedSt.newId
		value = date(value, "dd/mm/yyyy");
		return value;
    	},
	];

       filters.map((filter, index) => {
          defaultText = defaultText.replace(targetCurlys[index], filter());
          document.getElementById("Generated ID").innerHTML = defaultText;
       });
  }
  renders.push(curly_render_function_Generated ID);

 var cpFor_forA = function (event) {
        let originalElement = document.getElementById("forA");
        let container = originalElement.parentElement;

        for (var z in obj[0]) {
          let elem = originalElement.cloneNode(true);
          
          v=obj[0][z]
          k=z
          elem.id = "forA" + z;

   //Curly Braces Renderer
    const curly_render_function_forA = function() {
       let defaultText = `{{k}}`;
       const targetCurlys = [
		'{{k}}',
	];

       const filters = [
	   () => {
		let value = forthyear.k
		return value;
    	},
	];

       filters.map((filter, index) => {
          defaultText = defaultText.replace(targetCurlys[index], filter());
          document.getElementById("forA").innerHTML = defaultText;
       });
  }
  renders.push(curly_render_function_forA);


          elem.hidden = false;
          container.appendChild(elem);
          new_elements.push(elem);
        }
        originalElement.hidden = true;
      };
      renders.push(cpFor_forA);


 var cpFor_forB = function (event) {
        let originalElement = document.getElementById("forB");
        let container = originalElement.parentElement;

        for (var z in obj) {
          let elem = originalElement.cloneNode(true);
          
          st=obj[z]
          
          elem.id = "forB" + z;

 var cpFor_forC = function (event) {
        let originalElement = document.getElementById("forC");
        let container = originalElement.parentElement;

        for (var z in st) {
          let elem = originalElement.cloneNode(true);
          
          s=st[z]
          
          elem.id = "forC" + z;


          elem.hidden = false;
          container.appendChild(elem);
          new_elements.push(elem);
        }
        originalElement.hidden = true;
      };
      renders.push(cpFor_forC);


   //Curly Braces Renderer
    const curly_render_function_forB = function() {
       let defaultText = `{{s}}`;
       const targetCurlys = [
		'{{s}}',
	];

       const filters = [
	   () => {
		let value = forthyear.s
		return value;
    	},
	];

       filters.map((filter, index) => {
          defaultText = defaultText.replace(targetCurlys[index], filter());
          document.getElementById("forB").innerHTML = defaultText;
       });
  }
  renders.push(curly_render_function_forB);


          elem.hidden = false;
          container.appendChild(elem);
          new_elements.push(elem);
        }
        originalElement.hidden = true;
      };
      renders.push(cpFor_forB);


  function render() {
    setInterval(() => {
    for(let i = 0; i < new_elements.length; i++) {
          new_elements[i].remove();
      }
      for(let i = 0; i < changes.length; i++) {
          changes[i]();
      }
      changes = [];
      for (let i = 0; i < renders.length; i++) {
         renders[i]();
      }
    }, 1000);
  }
  render();

function date(dt, format) {
  const year = new Intl.DateTimeFormat("en", { year: "numeric" }).format(dt);
  const month = new Intl.DateTimeFormat("en", { month: "2-digit" }).format(
    dt
  );
  const day = new Intl.DateTimeFormat("en", { day: "2-digit" }).format(dt);
  const hour = dt.getHours();
  const min = dt.getMinutes();
  const sec = dt.getSeconds();

  switch (format) {
    case "mm-yyyy":
      return `${month}-${year}`;
    case "mm-yy":
      return `${month}-${year.slice(2)}`;
    case "dd/mm/yyyy h:m:s":
      return `${day}/${month}/${year} ${hour}:${min}:${sec}`;
    case "dd/mm/yyyy h:m":
      return `${day}/${month}/${year} ${hour}:${min}`;
    case "mm/dd/yyyy h:m:s":
      return `${month}/${day}/${year} ${hour}:${min}:${sec}`;
    case "mm/dd/yyyy h:m":
      return `${month}/${day}/${year} ${hour}:${min}`;
    case "mm-dd-yyyy h:m":
      return `${month}-${day}-${year} ${hour}:${min}`;
    case "dd-mm-yyyy h:m:s":
      return `${day}-${month}-${year} ${hour}:${min}:${sec}`;
    case "dd-mm-yyyy h:m":
      return `${day}-${month}-${year} ${hour}:${min}`;
    case "mm-dd-yyyy h:m:s":
      return `${month}-${day}-${year} ${hour}:${min}:${sec}`;
    default:
      return `${day}/${month}/${year}`;
  }
}
function lower(str) {
  return str.toLowerCase();
}
</script>