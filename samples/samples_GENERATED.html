<!-- --------------------------------------------------------------------- -->

<!DOCTYPE html>
<html lang="en">

<head>
 <title>Sample 7 everything</title>
</head>

<body id ="app"cp-app="forthyear">

<div>
 <span>Id</span> <input id ="id" type="number" cp-model="newObj.newId" /> <br />
 <span>Name</span> <input id ="name"  type="text" cp-model="newObj.newName" /> <br />
 <span>Date</span> <input id ="date" type="date" cp-model="newObj.newDate" /> <br />
 <button id ="click" @click="addSt()">Add</button>
</div>

<div id ="if" cp-if="newAddedSt.Id">
 <span id ="span1" >the new St id: {{newAddedSt.newId}}</span>
 <span id ="span2">the new St Name: {{newAddedSt.newName | lower}}</span>
 <span id ="span3">the new St Date: {{newAddedSt.newDate | date:'dd/mm/yyyy'}}</span> <!-- any date format you want  -->
</div>

<table>
 <tr id ="forOuter" cp-for="st in obj">
  <td id ="forInside"cp-for="s in st">{{s}}</td>
 </tr>
</table>


<script>
        function forthyear() {
            let scope = this;
            scope.newObj = {};
            scope.newAddedSt = {};
            scope.obj = [
                { id: 1, name: "St1", birthdate: new Date() },
                { id: 2, name: "St2", birthdate: new Date() },
                { id: 3, name: "St3", birthdate: new Date() },
                { id: 4, name: "St4", birthdate: new Date() },
                { id: 5, name: "St5", birthdate: new Date() },
                { id: 6, name: "St6", birthdate: new Date() },
            ]
            scope.addSt = function () {
                scope.newAddedSt = Object.assign({}, scope.newObj)
                scope.obj.push(Object.assign({}, scope.newObj));
                scope.newObj = {};
            }
        };

        var forthyear = new forthyear();

    </script>

</body>

</html>
<script type="text/javascript">
  let renders = [];
  let new_elements = [];
  let changes = [];

    //cp model template 
    if (forthyear.newObj.newId) {
    document.getElementById("id").value =
    forthyear.newObj.newId;
    }
    document.getElementById("id").addEventListener("input", (event) => {
    forthyear.newObj.newId = event.target.value;
    });

    //cp model template 
    if (forthyear.newObj.newName) {
    document.getElementById("name").value =
    forthyear.newObj.newName;
    }
    document.getElementById("name").addEventListener("input", (event) => {
    forthyear.newObj.newName = event.target.value;
    });

    //cp model template 
    if (forthyear.newObj.newDate) {
    document.getElementById("date").value =
    forthyear.newObj.newDate;
    }
    document.getElementById("date").addEventListener("input", (event) => {
    forthyear.newObj.newDate = event.target.value;
    });

	 // cp-event 
      const event_handler_click_click = function() {
        document.getElementById("click").addEventListener("click", (event) => {
            forthyear.addSt();
        });
    }
    changes.push(event_handler_click_click);

	// cp-if generated code 
   const cp_if_function_if = function() {
    const ifElement = document.getElementById("if");
    if (forthyear.newAddedSt.Id) {
      ifElement.hidden = false;
    }
    else{
      ifElement.hidden = true;
    }
  }
  renders.push(cp_if_function_if);

   //Curly Braces Renderer
    const curly_render_function_span1 = function() {
       let defaultText = `the new St id: {{forthyear.newAddedSt.newId}}`;
       const targetCurlys = [
		'{{forthyear.newAddedSt.newId}}',
	];

       const filters = [
	   () => {
		let value = forthyear.newAddedSt.newId
		return value;
    	},
	];

       filters.map((filter, index) => {
          defaultText = defaultText.replace(targetCurlys[index], filter());
          document.getElementById("span1").innerHTML = defaultText;
       });
  }
  renders.push(curly_render_function_span1);

   //Curly Braces Renderer
    const curly_render_function_span2 = function() {
       let defaultText = `the new St Name: {{forthyear.newAddedSt.newName|lower}}`;
       const targetCurlys = [
		'{{forthyear.newAddedSt.newName|lower}}',
	];

       const filters = [
	   () => {
		let value = forthyear.newAddedSt.newName
		value = lower(value);
		return value;
    	},
	];

       filters.map((filter, index) => {
          defaultText = defaultText.replace(targetCurlys[index], filter());
          document.getElementById("span2").innerHTML = defaultText;
       });
  }
  renders.push(curly_render_function_span2);

   //Curly Braces Renderer
    const curly_render_function_span3 = function() {
       let defaultText = `the new St Date: {{forthyear.newAddedSt.newDate|date:"dd/mm/yyyy"}}`;
       const targetCurlys = [
		'{{forthyear.newAddedSt.newDate|date:"dd/mm/yyyy"}}',
	];

       const filters = [
	   () => {
		let value = forthyear.newAddedSt.newDate
		value = date(value, "dd/mm/yyyy");
		return value;
    	},
	];

       filters.map((filter, index) => {
          defaultText = defaultText.replace(targetCurlys[index], filter());
          document.getElementById("span3").innerHTML = defaultText;
       });
  }
  renders.push(curly_render_function_span3);

 var cpFor_forOuter = function (event) {
        let originalElement = document.getElementById("forOuter");
        let container = originalElement.parentElement;

        for (var z in forthyear.obj) {
          let elem = originalElement.cloneNode(true);
           
          let st=forthyear.obj[z];
          
          elem.id = "forOuter" + z;

 var cpFor_forInside = function (event) {
        let originalElement = document.getElementById("forInside");
        let container = originalElement.parentElement;

        for (var z in st) {
          let elem = originalElement.cloneNode(true);
           
          let s=st[z];
          
          elem.id = "forInside" + z;

   //Curly Braces Renderer
    const curly_render_function_forInside = function() {
       let defaultText = `{{s}}`;
       const targetCurlys = [
		'{{s}}',
	];

       const filters = [
	   () => {
		let value = s
		return value;
    	},
	];

       filters.map((filter, index) => {
          defaultText = defaultText.replace(targetCurlys[index], filter());
          document.getElementById("forInside").innerHTML = defaultText;
       });
  }
  renders.push(curly_render_function_forInside);


          elem.hidden = false;
          container.appendChild(elem);
          new_elements.push(elem);
        }
        originalElement.hidden = true;
      };
      renders.push(cpFor_forInside);



          elem.hidden = false;
          container.appendChild(elem);
          new_elements.push(elem);
        }
        originalElement.hidden = true;
      };
      renders.push(cpFor_forOuter);


  function render() {
    setInterval(() => {
    for(let i = 0; i < new_elements.length; i++) {
          new_elements[i].remove();
      }
      for(let i = 0; i < changes.length; i++) {
          changes[i]();
      }
      changes = [];
      for (let i = 0; i < renders.length; i++) {
         renders[i]();
      }
    }, 1000);
  }
  render();

function date(dt, format) {
  if(!dt) return "-/-/-";
  dt = new Date(dt);
  const year = new Intl.DateTimeFormat("en", { year: "numeric" }).format(dt);
  const month = new Intl.DateTimeFormat("en", { month: "2-digit" }).format(
    dt
  );
  const day = new Intl.DateTimeFormat("en", { day: "2-digit" }).format(dt);
  const hour = dt.getHours();
  const min = dt.getMinutes();
  const sec = dt.getSeconds();

  switch (format) {
    case "mm-yyyy":
      return `${month}-${year}`;
    case "mm-yy":
      return `${month}-${year.slice(2)}`;
    case "dd/mm/yyyy h:m:s":
      return `${day}/${month}/${year} ${hour}:${min}:${sec}`;
    case "dd/mm/yyyy h:m":
      return `${day}/${month}/${year} ${hour}:${min}`;
    case "mm/dd/yyyy h:m:s":
      return `${month}/${day}/${year} ${hour}:${min}:${sec}`;
    case "mm/dd/yyyy h:m":
      return `${month}/${day}/${year} ${hour}:${min}`;
    case "mm-dd-yyyy h:m":
      return `${month}-${day}-${year} ${hour}:${min}`;
    case "dd-mm-yyyy h:m:s":
      return `${day}-${month}-${year} ${hour}:${min}:${sec}`;
    case "dd-mm-yyyy h:m":
      return `${day}-${month}-${year} ${hour}:${min}`;
    case "mm-dd-yyyy h:m:s":
      return `${month}-${day}-${year} ${hour}:${min}:${sec}`;
    default:
      return `${day}/${month}/${year}`;
  }
}
function lower(str) {
   if(!str) return "";  return str.toLowerCase();
}
</script>